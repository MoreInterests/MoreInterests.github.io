---
title: Linux-shell脚本
top: false
cover: false
toc: true
mathjax: false
author: xing xiao
tags: shell
categories: Linux
abbrlink: 47127
date: 2020-07-16 17:17:48
img:
coverImg:
password:
summary:
---

## shell脚本

### 1.shell脚本的本质

- 编译型语言C
- 解释型语言
  - she11脚本语言是解释型语言
  - she11脚本的本质
    - she11命令的有序集合

### 2.shell编程的基本过程

- 基本过程分为三步：
  - step1.建立she11文件包含任意多行操作系统命令或shel1命令的文本文件；
  - step2.赋予she11文件执行权限用chmod命令修改权限；
  - step3.执行she11文件直接在命令行上调用she11程序.

### 3.shell变量

- she11允许用户建立变量存储数据，但不支持数据类型（整型、字符、浮点型），将任何赋给变量的值都解释为一串字符                 

  ​																				Variable=value

  - count=1
  - echo $count
  - DATE=date
  - echo $DATE

- Bourne She11有如下四种变量：

  - 用户自定义变量
    - 在she11编程中通常使用全大写变量，方便识别
      -$COUNT=1
    - 变量的调用：在变量前加$
      -$ echo $HOME Linux She11/bash从右向左赋值
      -$Y=y
      -$X=SY
      -$ echo $X
    - 使用unset命令删除变量的赋值
      -$Z=hello
      -$ echo $Z
      -hello
      -$ unset Z-$ echo $Z
  - 位置变量即命令行参数
    - $0与键入的命令行一样，包含脚本文件名
    - $1，$2，……$9分别包含第一个到第九个命令行参数
    - $#包含命令行参数的个数
    - $@包含所有命令行参数：“$1，$2，……$9”
    - $？包含前一个命令的退出状态
    - $*包含所有命令行参数：“$1，$2，……$9”
    - $$包含正在执行进程的ID号
  - 预定义变量
  - 环境变量
    - 常用she环境变量
      - HOME:/etc/passwd文件中列出的用户主目录
      - IFS:Internal Field Separator，默认为空格，tab及换行符
      - PATH:she11搜索路径
      - PS1，PS2：默认提示符（$）及换行提示符（>）
      - TERM：终端类型，常用的有vt100，ansi，vt200，xterm等

### 4.shell程序和语句

- she11程序由零或多条she11语句构成。she11语句包括三类：说明性语句、功能性语句和结构性语句。
  - 说明性语句：
    以#号开始到该行结束，不被解释执行
  - 功能性语句：
    任意的shell命令、用户程序或其它she11程序。
  - 结构性语句：
    条件测试语句、多路分支语句、循环语句、循环控制语句等。

### 5.常用功能性语句(命令)

- read从标准输入读入一行，并赋值给后面的变量，其语法为：
  read var

  把读入的数据全部赋给var 

  read varl var2 var3

  把读入行中的第一个单词（word）赋给var1，第二个单词赋给var2，……把其余所有的词赋给最后一个变量.

- 如果执行read语句时标准输入无数据，则程序在此停留等侯，直到数据的到来或被终止运行。



### 6.expr命令

- 算术运算命令expr主要用于进行简单的整数运算，包括加（+）、减（一）、乘（ \ * ）、整除（/）和求模（%）等操作。例如：

  ```bash
  $expr 12 + 5 \* 3
  
  27
  $expr 3 - 8 / 2
  
  -1
  
  
  
  $num=9
  $sum=expr $num*6
  $echo $sum
  54
  ```



### 7.test语句

- test语句可测试三种对象：
  字符串      整数     文件属性

- 每种测试对象都有若干测试操作符

- 例如：
  test "$answer" = "yes"

  变量answer的值是否为字符串yes

  

  test  $num - eq 18
  变量num的值是否为整数18

  

  test -d tmp
  测试tmp是否为一个目录名

#### 1.字符串测试

- s1=s2测试两个字符串的内容是否完全一样
- s1！=s2测试两个字符串的内容是否有差异
- -z s1测试s1字符串的长度是否为0
- -n s1测试s1字符串的长度是否不为0



#### 2.整数测试

- a -eq b测试a与b是否相等
- a -ne b测试a与b是否不相等
- a -gt b测试a是否大于b
- a -ge b测试a是否大于等于b
- a -It b测试a是否小于b
- a -le b测试a是否小于等于b



#### 3.文件测试

- -d name 测试name 是否为一个目录
- -e name测试一个文件是否存在
- -f name测试name是否为普通文件
- -Lname测试name是否为符号链接
- -r name 测试name文件是否存在且为可读
- -wname测试name文件是否存在且为可写
- -xname测试name文件是否存在且为可执行
- -s name 测试name文件是否存在且其长度不为0
- f1-nt f2测试文件fl是否比文件f2更新
- f1-ot f2测试文件f1是否比文件f2更旧



### 8.结构性语句

- 结构性语句主要根据程序的运行状态、输入数据、变量的取值、控制信号以及运行时间等因素来控制程序的运行流程。
- 主要包括：条件测试语句（两路分支）、多路分支语句、循环语句、循环控制语句和后台执行语句等。



#### 1.条件语句

- if…then…fi
- 语法结构：
        if   表达式
                        then 命令表
        fi
  - 如果表达式为真，则执行命令表中的命令；否则退出if语句，即执行fi后面的语句。
  - if和fi是条件语句的语句括号，必须成对使用；
  - 命令表中的命令可以是一条，也可以是若干条。

- if...then...else...fi
- 语法结构为：
   if         表达式
  then      命令表1
- else      命令表2
  fi
- 如果表达式为真，则执行命令表1中的命令，再退出if语句；否则执行命令表2中的语句，再退出if语句.
  注意：无论表达式是否为真，都有语句要执行.

#### 2.多路分支语句

- case...esac多路分支语句case用于多重条件测试，语法结构清晰自然.其语法为：

  case             字符串变量     in

  ​					模式1）

  ​										命令表1
   										；；

  ​					模式2|模式3）

  ​										命令表2
  ​										；；  

  ​          		  	……  
 				      模式n）

  ​										命令表n
   										；；

  esac

### 9.循环语句

#### 1.循环语句for

- 当循环次数已知或确定时，使用for循环语句来多次执行一条或一组命令。
  循环体由语句括号do和done来限定。格式为：
  for   变量名    in   单词表
   					do

  ​						命令表

  ​				done

- 变量依次取单词表中的各个单词，每取一次单词，就执行一次循环体中的命令.循环次数由单词表中的单词数确定.命令表中的命令可以是一条，也可以是由分号或换行符分开的多条。

- 如果单词表是命令行上的所有位置参数时，可以在for in单词表”部分。

#### 2.循环语句while

- 语法结构为：
  while	命令或表达式
  	do

  ​			命令表
  ​	done

  - while语句首先测试其后的命令或表达式的值，如果为真，就执行一次循环体中的命令，然后再测试该命令或表达式的值，执行循环体，直到该命令或表达式为假时退出循环。
  - while语句的退出状态为命令表中被执行的最后一条命令的退出状态

  

### 10.循环控制语句

- break和 continue 

  - break n则跳出n层；
  - continue语句则马上转到最近一层循环语句的下一轻循环上，
  - continue n则转到最近n层循环语句的下一轮循环上.

  

  实例.程序prog7的用法为：
   	prog7		整数		整数		整数		…
  参数个数不确定，范围为1~10个，每个参数都是正整数。

### 11.shell函数调用

- 函数调用格式：
  方式1：
  	value_name=function_name[argl arg2....]

  方式2：
  	function_name[arg1 arg2..]
  	echo $？

### 12.函数变量作用域

- 全局作用域：在脚本的其他任何地方都能够访问该变量。
- 局部作用域：只能在声明变量的作用域内访问。
- 声明局部变量的格式：
  - Local variable name =value